"use strict";var _this=void 0;function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach(function(t){_defineProperty(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,t||"default");if("object"!=_typeof(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=Array(t);n<t;n++)a[n]=e[n];return a}function _iterableToArrayLimit(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,r,i,o,l=[],s=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;s=!1}else for(;!(s=(a=i.call(n)).done)&&(l.push(a.value),l.length!==t);s=!0);}catch(e){c=!0,r=e}finally{try{if(!s&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw r}}return l}}function _arrayWithHoles(e){if(Array.isArray(e))return e}for(var map,layer,cursors,jumpButton,result,animate,gun,_ret,buttons={},BLOCK_SZ=32,sleep=function(e){return new Promise(function(t){return setTimeout(t,e)})},isNanthy=function(e){return e==nanthy.sprite},fmtNum=function(e){var t=_slicedToArray(e.toString().split("."),2),n=t[0],a=t[1];return n.replace(/\B(?=(\d{3})+(?!\d))/g,",")+(a?"."+a:"")},makeRectangle=function(e,t,n,a,r){var i=game.add.bitmapData(n,a),o=i.ctx;return o.beginPath(),o.rect(0,0,n,a),o.fillStyle=r,o.fill(),game.add.sprite(e,t,i)},nanthy={direction:"right",doNothing:!0,respawn:function(e){var t=level.data,n=t?t.spawn:{x:2,y:8},a=n.x,r=n.y,i=game.world.height/10*(r+1)-nanthy.sprite.height/2,o=BLOCK_SZ*a+nanthy.sprite.width/2;nanthy.sprite.scale.x=Math.abs(nanthy.sprite.scale.x),nanthy.direction="right",[10,100,1e3].forEach(function(e){return sleep(e).then(function(e){nanthy.sprite.body.width=Math.abs(nanthy.sprite.width/3)})}),sleep(10).then(function(e){return nanthy.sprite.reset(o,i)}),level.bornTween&&level.bornTween.stop(),level.bornTween=game.add.tween(nanthy.sprite).to({alpha:0},400,Phaser.Easing.Bounce.InOut,!0,0,-1,!0),level.bornTween.start(),nanthy.sprite.body.moves=!(level.gameInit=!0),nanthy.sprite.animations.play("wait",20,!0)},unInit:function(e){nanthy.sprite.body.moves=!(level.gameInit=!1),level.bornTween&&level.bornTween.stop(),nanthy.sprite.alpha=1},resetMe:function(e){nanthy.respawn(),level.hasKey=nanthy.hasGun=nanthy.hasJet=nanthy.jet=!1}},level={},BLOCKS={jet:3,gun:13,chalice:19,door:10,faux:{grass:37,pink_faux_bar:30},points:function(e){return BLOCKS.p},p:{gum:5,diamond:11,r_diamond:12,crown:24,wand:25,ring:26},collisions:function(e){return BLOCKS.c},c:{slant:{bl:14,br:15,tl:16,tr:17},pink_bar:{down:29,right:18},metal_bar:4,pipe:{down:28,right:27},brown:23,ice:34,brick:{blue:39,red:40}},death:function(e){return BLOCKS.b},bad:function(e){return BLOCKS.b},b:{fire:2,water:35,electricity:41},climb_blocks:function(e){return BLOCKS.cl},cl:{trunk:38,leaves:{tl:20,tr:23,cnt:32,bl:31,br:33},star:36},g:function(e,t){if("g"!=e&&"FLATTENED"!=e){var n=function(e,a){var r=a||[];if("object"!=_typeof(e)||t?r.push(e):Object.keys(e).forEach(function(t){return n(e[t],r)}),!a)return r},a=e.split(".").reduce(function(e,n){return("function"!=typeof(a=e[n])||t?a:a())||"";var a},this);return"function"==typeof a?a=a():"object"==_typeof(a)&&(a=n(a)),a||console.error("[Block::Fetch] Path",e,"is invalid!"),a}console.error("[Block::Fetch] Path",e,"disallowed")},FLATTENED:{}},_AUDIO_LINK={TRACKS:[["music","assets/audio-ogg/Underclocked.ogg"],["gun","assets/audio-ogg/gun.ogg"],["explosion","assets/audio-ogg/explosion.ogg"],["gong","assets/audio-ogg/gong.ogg"],["coin","assets/audio-ogg/coin.ogg"],["coinDrop","assets/audio-ogg/coin-drop.ogg"],["coin3","assets/audio-ogg/glass-ping.ogg"],["itemPick","assets/audio-ogg/robot-blip.ogg"],["blip","assets/audio-ogg/sms-alert.ogg"]],_EFFECTS_LINK:{coinDrop:"points",coin:"points.gum",itemPick:["jet","gun"],gong:"chalice",explosion:"death"}},AUDIO={EFFECTS:{}},Process=Object.keys(BLOCKS),_loop=function(){var e=Process.pop(),t=BLOCKS.g(e,!0);return t?"function"==typeof t?0:t instanceof Array?(Object.keys(t[0]).forEach(function(t){return Process.push(e+"."+t)}),0):void(BLOCKS.FLATTENED[e.split(".").slice(-1)[0]]=t):0};Process.length;)_ret=_loop();Object.keys(_AUDIO_LINK._EFFECTS_LINK).forEach(function(e){var t=function(e){return e instanceof Array?e:[e]};t(_AUDIO_LINK._EFFECTS_LINK[e]).forEach(function(n){t(BLOCKS.g(n)).forEach(function(t){AUDIO.EFFECTS[t]=e})})}),level.preload=function(e){game.load.json("levelData","assets/Level-"+game.level+".config.json"),game.load.tilemap("objects","assets/Level-"+game.level+".json",null,Phaser.Tilemap.TILED_JSON),game.load.image("tiles","assets/items2.png"),game.load.image("bullet","assets/bullet.png"),game.load.image("border","assets/border-top.png"),game.load.image("face","assets/face.png"),game.load.spritesheet("nanthy","assets/Dave.png",36,BLOCK_SZ),game.load.spritesheet("electricity","assets/electricity.png",BLOCK_SZ,BLOCK_SZ),game.load.spritesheet("water","assets/water.png",BLOCK_SZ,BLOCK_SZ),game.load.spritesheet("fire","assets/fire.png",BLOCK_SZ,BLOCK_SZ),game.load.spritesheet("chalice","assets/chalice.png",BLOCK_SZ,BLOCK_SZ),_AUDIO_LINK.TRACKS.forEach(function(e){return game.load.audio(e[0],e[1])})},level.create=function(e){game.physics.startSystem(Phaser.Physics.ARCADE),game.stage.backgroundColor="#000000",game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,map=game.add.tilemap("objects"),_AUDIO_LINK.TRACKS.forEach(function(e){var t=e[0];AUDIO[t]=AUDIO[t]||game.add.audio(t)}),map.addTilesetImage("Assets","tiles"),(layer=map.createLayer("Level 1")).resizeWorld(),level.score=game.score,level.data=game.cache.getJSON("levelData"),BLOCKS.g("collisions").forEach(function(e){return map.setCollisionByIndex(e)}),BLOCKS.g("collisions").forEach(function(e){return map.setTileIndexCallback(e,level.bulletKill,level)}),map.setTileIndexCallback(BLOCKS.g("jet"),level.gotJetpack,level),map.setTileIndexCallback(BLOCKS.g("gun"),level.gotGun,level),map.setTileIndexCallback(BLOCKS.g("chalice"),level.gotKey,level),map.setTileIndexCallback(BLOCKS.g("door"),level.finishLevel,level),map.setTileIndexCallback(BLOCKS.g("points.gum"),level.itemPickup(50),level),map.setTileIndexCallback(BLOCKS.g("points.diamond"),level.itemPickup(100),level),map.setTileIndexCallback(BLOCKS.g("points.r_diamond"),level.itemPickup(150),level),map.setTileIndexCallback(BLOCKS.g("points.ring"),level.itemPickup(200),level),map.setTileIndexCallback(BLOCKS.g("points.crown"),level.itemPickup(300),level),map.setTileIndexCallback(BLOCKS.g("points.wand"),level.itemPickup(500),level),animate={},["fire","electricity","water","chalice"].forEach(function(e){animate[e]=game.add.group()}),Object.keys(animate).forEach(function(e){animate[e].enableBody=!0,map.createFromObjects(e,{chalice:19,fire:2,electricity:41,water:35}[e],e,0,!0,!1,animate[e])}),level.initiateElementAnimations(),nanthy.sprite=game.add.sprite(32,32,"nanthy"),nanthy.sprite.scale.setTo(.91,.91),nanthy.sprite.anchor.x=.5,nanthy.sprite.anchor.y=.5,game.physics.enable(nanthy.sprite),game.physics.arcade.gravity.y=400;var t=game.world.bounds;game.world.setBounds(t.x,t.y-BLOCK_SZ,t.width,t.height),nanthy.sprite.body.bounce.y=0,nanthy.sprite.body.width=nanthy.sprite.width/3,nanthy.sprite.body.offset.x=(nanthy.sprite.width-nanthy.sprite.body.width)/2,nanthy.sprite.body.linearDamping=1,nanthy.sprite.body.collideWorldBounds=!1,nanthy.sprite.animations.add("left",[1,2,3,2],10,!0),nanthy.sprite.animations.add("wait",[0],10,!0),nanthy.sprite.animations.add("jetpack",[5,6,7],10,!0),nanthy.sprite.animations.add("jump",[4],10,!0),nanthy.sprite.animations.add("climb",[8,9,10,9],10,!0),nanthy.sprite.body.fixedRotation=!0,nanthy.resetMe(),nanthy.tweener=game.add.tween(nanthy.sprite.position).to({y:"+2"},2e3,Phaser.Easing.Linear.None,!0,0,1e3,!0),nanthy.tweener.stop(),(gun=game.add.weapon(2,"bullet")).fireRate=500,gun.fireAngle=0,gun.bulletSpeed=300,gun.bulletGravity.y=-game.physics.arcade.gravity.y,gun.bulletKillType=Phaser.Weapon.KILL_CAMERA_BOUNDS;var n=DIMS.PAD,a=DIMS.TOOLBAR-n,r={font:a-1+"px Raleway,Arial",fill:"#23b929",boundsAlignV:"center"};level.statics={textBg:makeRectangle(0,0,DIMS.width,a,"#000000"),border:game.add.tileSprite(-BLOCK_SZ/2,a,DIMS.width+BLOCK_SZ/2,n,"border"),footerBg:makeRectangle(0,game.world.height+DIMS.TOOLBAR+2*DIMS.PAD,DIMS.width,DIMS.FOOT,"#000000")},level.texts={title:game.add.text(0,0,"NANTHY",r),score:game.add.text(0,0,"SCORE",_objectSpread({boundsAlignH:"right"},r)),jet:game.add.text(0,DIMS.height+BLOCK_SZ,"JETPACK",r),gun:game.add.text(0,DIMS.height+BLOCK_SZ,"GUN",_objectSpread({boundsAlignH:"right"},r)),key:game.add.text(0,DIMS.height+2*BLOCK_SZ,"GO THRU THE DOOR!",_objectSpread({boundsAlignH:"center"},r))};var i={key:1,gun:1,jet:1};Object.keys(level.statics).forEach(function(e){level.statics[e].fixedToCamera=!0}),Object.keys(level.texts).forEach(function(e){var t=level.texts[e];t.setTextBounds(0,0,DIMS.width,i[e]?a:BLOCK_SZ),i[e]&&(t.alpha=0),t.fixedToCamera=!0}),level.setScore(level.score),game.camera.follow(nanthy.sprite),cursors=game.input.keyboard.createCursorKeys(),buttons.run=game.input.keyboard.addKey(Phaser.Keyboard.SHIFT),buttons.jet=game.input.keyboard.addKey(Phaser.Keyboard.ALT),buttons.gun=game.input.keyboard.addKey(Phaser.Keyboard.CONTROL),AUDIO.music.onStop.add(function(e){return AUDIO.music.play()},_this),AUDIO.music.play()},level.initiateElementAnimations=function(e){Object.keys(animate).forEach(function(e){animate[e].setAll("body.immovable",!0),animate[e].setAll("body.moves",!1);var t=[0,1,2,3];"chalice"==e&&(t=t.concat(t.slice(0,3).reverse())),animate[e].callAll("animations.add","animations","an",t,function(e){return{fire:10,chalice:7}[e]||5}(e),!0),animate[e].children.forEach(function(e){return setTimeout(function(t){return e.animations.play("an")},70*Math.random())}),animate[e].children.forEach(function(t){var n;if("chalice"!=t){var a;t.body.setCircle((a=e,{fire:.8*t.width/2}[a]||.9*t.width/2)),(n=t.body.offset).setTo.apply(n,_toConsumableArray(function(e){return{fire:[.2*t.width/2+1,.2*t.width/.8]}[e]||[.1*t.width/2,.1*t.height/2]}(e)))}})})},level.finishLevel=function(e,t){if(!isNanthy(e)||!this.hasKey)return!1;level.bornTween="",game.score=this.score+2e3,game.level++,game.state.start("Level")},level.bulletKill=function(e,t){return isNanthy(e)||e.kill(),!0},level.died=function(e,t){isNanthy(e)&&(console.log("Died"),e.kill(),console.log(e,t),level.playEffect(t),(e=this.game.add.sprite(e.x,e.y,"fire")).anchor.setTo(.5,.5),e.animations.add("fire",[0,1,2,3],2,!1),e.animations.play("fire"),e.animations.currentAnim.onComplete.add(function(t){nanthy.respawn(),sleep(200).then(function(t){return e.destroy()})},this))},level.itemPickup=function(e){return function(t,n){isNanthy(t)&&(level.playEffect(n),level.addScore(e),level.clearTile(n))}},level.gotGun=function(e,t){isNanthy(e)&&(level.showFooterText("gun"),nanthy.hasGun=!0,this.playEffect(t),this.clearTile(t))},level.gotJetpack=function(e,t){isNanthy(e)&&(level.showFooterText("jet"),nanthy.hasJet=!0,this.playEffect(t),this.clearTile(t))},level.gotKey=function(e,t){isNanthy(e)&&(level.playEffect(t),t.destroy(),level.showFooterText("key"),this.hasKey=!0,this.addScore(1e3))},level.showFooterText=function(e){return game.add.tween(level.texts[e]).to({alpha:1},400,Phaser.Easing.Bounce.InOut,!0)},level.clearTile=function(e){e&&map.removeTile(e.x,e.y,layer).destroy()}.bind(level),level.playEffect=function(e){if(e){e.key&&(e=BLOCKS.FLATTENED[e.key]);var t=AUDIO[AUDIO.EFFECTS[e.index||e]];t&&t.play()}},level.addScore=function(e){this.setScore(this.score+(e||0))}.bind(level),level.setScore=function(e){this.score=e||0,isNaN(this.score)&&(this.score=0),level.texts.score.setText("SCORE: ".concat(fmtNum(this.score)))}.bind(level),level.toggleJetpack=function(){!nanthy.hasJet||!nanthy.sprite.alive||this._nextToggle_jet&&this.game.time.time<this._nextToggle_jet||(this._nextToggle_jet=this.game.time.time+300,nanthy.jet=!nanthy.jet,nanthy.jet?nanthy.tweener.start():nanthy.tweener&&nanthy.tweener.stop())},level.shootGun=function(){nanthy.hasGun&&nanthy.sprite.alive&&(gun.fireAngle="right"===nanthy.direction?0:180,gun.fireFrom.setTo(nanthy.sprite.x+8*(gun.fireAngle?-1:1),nanthy.sprite.y-8),gun.fire()&&AUDIO.gun.play())},level.update=function(e){var t=game.physics.arcade;t.collide(nanthy.sprite,layer),t.collide(gun.bullets,layer),t.overlap(nanthy.sprite,animate.fire,level.died,null,level),t.overlap(nanthy.sprite,animate.water,level.died,null,level),t.overlap(nanthy.sprite,animate.electricity,level.died,null,level),t.overlap(nanthy.sprite,animate.chalice,level.gotKey,null,level),nanthy.doNothing=!0,buttons.gun.isDown&&level.shootGun.bind(level)(),buttons.jet.isDown&&level.toggleJetpack.bind(level)(),nanthy.hasJet&&nanthy.jet&&!level.gameInit?level.jetControls.bind(level)():level.movementControls.bind(level)();var n=2.5*BLOCK_SZ;nanthy.sprite.y<-n&&(nanthy.sprite.y=game.world.height+n),nanthy.sprite.y>game.world.height+n&&(nanthy.sprite.y=-n),nanthy.sprite.body.velocity.y=Math.min(nanthy.sprite.body.velocity.y,180)},level.ensureDirection=function(e){nanthy.direction!=e&&("left"==nanthy.direction&&nanthy.sprite.scale.x>0&&(nanthy.sprite.scale.x*=-1),nanthy.sprite.scale.x*=-1,nanthy.direction=e)},level.jetControls=function(){nanthy.sprite.animations.play("jetpack",10,!0);var e=150,t={x:0,y:0};cursors.left.isDown?(level.ensureDirection("left"),t.x-=e):cursors.right.isDown&&(level.ensureDirection("right"),t.x+=e),cursors.up.isDown?t.y-=e:cursors.down.isDown&&(t.y+=e),nanthy.sprite.body.velocity.x=t.x,nanthy.sprite.body.velocity.y=t.y-6.5},level.movementControls=function(){var e=nanthy.sprite.body.onFloor(),t={rest:10+(e?0:70),run:200,walk:130,jump:230},n=function(e){return level.gameInit&&nanthy.unInit()};cursors.left.isDown?(n(),level.ensureDirection("left"),(0==nanthy.sprite.body.velocity.x||"left"!=nanthy.sprite.animations.currentAnim.name&&e)&&nanthy.sprite.animations.play("left",10,!0),nanthy.sprite.body.velocity.x-=t.rest,nanthy.sprite.body.velocity.x=Math.max(nanthy.sprite.body.velocity.x,-t[buttons.run.isDown?"run":"walk"]),nanthy.doNothing=!1):cursors.right.isDown&&(n(),level.ensureDirection("right"),(0==nanthy.sprite.body.velocity.x||"left"!=nanthy.sprite.animations.currentAnim.name&&e)&&nanthy.sprite.animations.play("left",10,!0),nanthy.sprite.body.velocity.x+=t.rest,nanthy.sprite.body.velocity.x=Math.min(nanthy.sprite.body.velocity.x,t[buttons.run.isDown?"run":"walk"]),nanthy.doNothing=!1),cursors.up.isDown&&(n(),nanthy.sprite.animations.play("jump",20,!0),e&&(AUDIO.blip.play(),nanthy.sprite.body.velocity.y=-t.jump,nanthy.doNothing=!1)),"jetpack"==nanthy.sprite.animations.currentAnim.name&&nanthy.sprite.animations.play(e?"left":"jump",10,!0),nanthy.doNothing&&(nanthy.sprite.body.velocity.x>20?nanthy.sprite.body.velocity.x-=20:nanthy.sprite.body.velocity.x<-20?nanthy.sprite.body.velocity.x+=20:nanthy.sprite.body.velocity.x=0,e&&nanthy.sprite.animations.play("wait",20,!0))},level.render=function(e){};var DIMS={width:19*BLOCK_SZ,height:10*BLOCK_SZ,PAD:BLOCK_SZ/8,TOOLBAR:7*BLOCK_SZ/8,FOOT:1.875*BLOCK_SZ},game=new Phaser.Game(DIMS.width,DIMS.height+2*DIMS.PAD+DIMS.TOOLBAR+DIMS.FOOT,Phaser.AUTO,"game",void 0,!0);game.state.add("Level",level),game.level=1,game.score=0,game.state.start("Level");